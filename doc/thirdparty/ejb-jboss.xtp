<document>
  <header>
    <product>resin</product>
    <resin-2.0>$resin/ref/ejb-jboss.xtp</resin-2.0>
    <title>jBoss EJB</title>
  </header>

  <body>
    <summary/>

<s1 title="jBoss EJB">
<p>
From Dave Dribin:
</p>

<p>To have a Resin web application use jBoss, do the following:</p>

<ol>
<li>Copy "ejb.jar", "jboss-client.jar", and "jnp-client.jar" from
$JBOSS_HOME/client into WEB-INF/lib.

</li><li>Copy the EJB jar file that you put in $JBOSS_HOME/deploy into
WEB-INF/lib.

</li><li>Put the following &lt;web-app&gt; into resin.conf:

<example>
&lt;web-app id='/web-app-path' app-dir='/real/path/of/web-app'&gt;
  &lt;jndi-link&gt;
    &lt;jndi-name&gt;java:comp/env/ejb&lt;/jndi-name&gt;
    &lt;jndi-factory&gt;org.jnp.interfaces.NamingContextFactory&lt;/jndi-factory&gt;
    &lt;init-param java.naming.provider.url="localhost:1099"/&gt;
  &lt;/jndi-link&gt;
&lt;/web-app&gt;
</example>

Of course change the JNDI URL if you're running jBoss on a different
machine.

</li><li>
Make sure you map all of your EJBs to the "ejb/" JNDI
context.  For example, I have this in my jboss.xml:

<example>
&lt;enterprise-beans&gt;
  &lt;entity&gt;
    &lt;ejb-name&gt;UserBean&lt;/ejb-name&gt;
    &lt;jndi-name&gt;ejb/UserHome&lt;/jndi-name&gt;
  &lt;/entity&gt;

  .... other beans ....

&lt;/enterprise-beans&gt;
</example>

This way you can lookup all the Home interfaces in the
"java:comp/env/ejb/" context.
</li></ol>

<p>I've attached a simple JSP that shows how to access the User EJB.</p>

<p>And don't forget that if you re-deploy your beans to jBoss, you should
copy over the jar file into WEB-INF and restart Resin.
</p>

<p>Hope that helps!</p>

<p>-Dave</p>

<example>
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;EJB Test&lt;/title&gt;
  &lt;/head&gt;

  &lt;body bgcolor="#FFFFFF"&gt;
    &lt;%@ page import='javax.naming.*' %&gt;
    &lt;%@ page import='ejbeans.*' %&gt;
    &lt;%@ page import='javax.rmi.*' %&gt;
    &lt;h1 align=center&gt;EJB Test&lt;/h1&gt;

    &lt;%
            // Get a naming context
            InitialContext jndiContext;
            Object ref;

            // Get a reference to a UserHome Bean
            jndiContext = new InitialContext();
            ref         = jndiContext.lookup("java:comp/env/ejb/UserHome");

            int         userPK;

            UserHome    userHome;
            User        user;

            userHome = (UserHome)
                PortableRemoteObject.narrow (ref, UserHome.class);

            userPK  = Integer.parseInt(request.getParameter("pk"));
            user    = userHome.findByPrimaryKey(new UserPK(userPK));
    %&gt;

    &lt;table border="3" width="100%"&gt;
        &lt;tr&gt;
          &lt;th&gt; ID &lt;/th&gt;
          &lt;th&gt; First Name &lt;/th&gt;
          &lt;th&gt; Last Name &lt;/th&gt;
        &lt;/tr&gt;

        &lt;tr&gt;
          &lt;th&gt; &lt;%= user.getId() %&gt; &lt;/th&gt;
          &lt;th&gt; &lt;%= user.getFirstName() %&gt; &lt;/th&gt;

          &lt;th&gt; &lt;%= user.getLastName() %&gt; &lt;/th&gt;
        &lt;/tr&gt;

    &lt;/table&gt;

  &lt;/body&gt;
&lt;/html&gt;
</example>
</s1>
  </body>
</document>
