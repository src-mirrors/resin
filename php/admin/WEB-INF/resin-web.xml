<web-app xmlns="http://caucho.com/ns/resin"
         xmlns:resin="http://caucho.com/ns/resin/core">

  <!--
     - Configuration for the administration application
    -->

  <resin:set var="resin_admin_user" default="admin"/>

  <authenticator>
    <type>com.caucho.server.security.XmlAuthenticator</type>

    <init>
      <resin:if test="${not empty(resin_admin_password)}">
        <user name="${resin_admin_user}"
	      password="${resin_admin_password}" roles='read,write'/>
      </resin:if>
    </init>
  </authenticator>

  <login-config auth-method="form">
     <form-login-config form-login-page='/login.php'
                        form-error-page='/login.php'/>
  </login-config>

  <resin:if test="${! resin_admin_external}">
    <security-constraint>
      <web-resource-collection url-pattern="*.php"/>
      
      <ip-constraint>
        <allow>127.0.0.1</allow>
        <allow>192.168/16</allow>
      </ip-constraint>
    
      <auth-constraint role-name="*"/>
    </security-constraint>
  </resin:if>

  <servlet servlet-name="resin-php"
           servlet-class="com.caucho.quercus.servlet.QuercusServlet">
  </servlet>

  <servlet-mapping url-pattern="*.php" servlet-name="resin-php"/>
  
  <security-constraint>
    <web-resource-collection url-pattern="*.php"/>
      
    <auth-constraint role-name="*"/>
  </security-constraint>

  <!--
     - Provide a remote interface for instances of the administration 
     - application on other servers.
    -->
  <servlet servlet-name='remote'
           servlet-class='com.caucho.hessian.server.HessianServlet'>
    <init>
      <service resin:type="com.caucho.services.jmx.JMXService">
        <mbean-server>${jndi("jmx/MBeanServer")}</mbean-server>
      </service>
     </init>
  </servlet>

  <servlet-mapping url-pattern='/remote' servlet-name='remote'/>

  <!--
    - Provide a remote interface for jsr88 deployment
   -->

  <servlet servlet-name='deploy'
           servlet-class='com.caucho.j2ee.deployserver.DeploymentServlet'>
  </servlet>

  <servlet-mapping url-pattern='/deploy' servlet-name='deploy'/>
</web-app>
