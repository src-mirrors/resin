<web-app xmlns="http://caucho.com/ns/resin"
         xmlns:resin="http://caucho.com/ns/resin/core">

  <!--
     - Configuration for the administration application
    -->


  <authenticator>
    <type>com.caucho.server.security.XmlAuthenticator</type>

    <init>
      <resin:if test="${not empty(resin_admin_password)}">
        <user name='admin' password='${resin_admin_password}' roles='read,write'/>
      </resin:if>
    </init>
  </authenticator>

  <login-config auth-method="form">
     <form-login-config form-login-page='/login.php'
                        form-error-page='/login.php'/>
  </login-config>

  <servlet servlet-name="resin-php"
           servlet-class="com.caucho.quercus.servlet.QuercusServlet">
  </servlet>

  <welcome-file-list>index.php</welcome-file-list>

  <servlet-mapping url-pattern="*.php" servlet-name="resin-php"/>

  <servlet-mapping url-pattern="/*" servlet-name="plugin-match"/>
  
  <security-constraint>
    <web-resource-collection url-pattern="*.php"/>
      
    <auth-constraint role-name="*"/>
  </security-constraint>

  <resin:if test="${resin_admin_localhost}">
    <security-constraint>
      <web-resource-collection url-pattern="*.php"/>
      
      <ip-constraint>
        <allow>127.0.0.1</allow>
        <allow>192.168/16</allow>
      </ip-constraint>
    </security-constraint>
  </resin:if>

  <!--
     - Provide a remote interface for instances of the administration 
     - application on other servers.
    -->
  <servlet servlet-name='remote'
           servlet-class='com.caucho.hessian.server.HessianServlet'>
    <init>
      <service resin:type="com.caucho.services.jmx.JMXService">
        <mbean-server>${jndi("jmx/MBeanServer")}</mbean-server>
      </service>
     </init>
  </servlet>

  <servlet-mapping url-pattern='/remote' servlet-name='remote'/>

  <!--
    - Provide a remote interface for jsr88 deployment
   -->

  <servlet servlet-name='deploy'
           servlet-class='com.caucho.j2ee.deployserver.DeploymentServlet'>
  </servlet>

  <servlet-mapping url-pattern='/deploy' servlet-name='deploy'/>

  <!--
    - Security constraints limit access to remote management
   -->

  <security-constraint>
    <web-resource-collection>
      <url-pattern>/remote</url-pattern>
      <url-pattern>/deploy</url-pattern>
    </web-resource-collection>
    
    <auth-constraint role-name='*'/>
  </security-constraint>

</web-app>
